<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-develop/rust/socket_networking/server">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">4.4.1 Server | WasmEdge Book</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://alabulei1.github.io/book/zh-Hans/develop/rust/socket_networking/server"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4.4.1 Server | WasmEdge Book"><meta data-rh="true" name="description" content="As we described in the client chapter, with the WasmEdge socket API, it is also possible for Rust developers to work directly on the socket level. In order for WasmEdge to become a cloud-native runtime for microservices, it needs to support HTTP servers. So, in this chapter, we will discussan HTTP server example and a non-blocking HTTP server example."><meta data-rh="true" property="og:description" content="As we described in the client chapter, with the WasmEdge socket API, it is also possible for Rust developers to work directly on the socket level. In order for WasmEdge to become a cloud-native runtime for microservices, it needs to support HTTP servers. So, in this chapter, we will discussan HTTP server example and a non-blocking HTTP server example."><link data-rh="true" rel="icon" href="/book/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://alabulei1.github.io/book/zh-Hans/develop/rust/socket_networking/server"><link data-rh="true" rel="alternate" href="https://alabulei1.github.io/book/develop/rust/socket_networking/server" hreflang="en"><link data-rh="true" rel="alternate" href="https://alabulei1.github.io/book/zh-Hans/develop/rust/socket_networking/server" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://alabulei1.github.io/book/develop/rust/socket_networking/server" hreflang="x-default"><link rel="stylesheet" href="/book/zh-Hans/assets/css/styles.bf154a13.css">
<link rel="preload" href="/book/zh-Hans/assets/js/runtime~main.bbb049d8.js" as="script">
<link rel="preload" href="/book/zh-Hans/assets/js/main.29a7dd9a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/book/zh-Hans/"><div class="navbar__logo"><img src="/book/zh-Hans/img/logo.svg" alt="WasmEdge Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/book/zh-Hans/img/logo.svg" alt="WasmEdge Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">WasmEdge</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/book/zh-Hans/develop/overview">Develop</a><a class="navbar__item navbar__link" href="/book/zh-Hans/embed/overview">Embed</a><a class="navbar__item navbar__link" href="/book/zh-Hans/contribute/overview">Contribute</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link icon-link language navbar__item"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/book/develop/rust/socket_networking/server" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/book/zh-Hans/develop/rust/socket_networking/server" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="https://translate.google.com/" target="_blank" class="dropdown__link">Translate<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/WasmEdge/WasmEdge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/book/zh-Hans/develop/overview">Guide for Developing Wasm Applications</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/getting-started-with-wasmedge">Getting Started with WasmEdge</a><button aria-label="打开/收起侧边栏菜单「Getting Started with WasmEdge」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/what-is-wasmedge">What is WasmEdge</a><button aria-label="打开/收起侧边栏菜单「What is WasmEdge」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/building-and-running-wasmedge-apps">Building and running WasmEdge apps</a><button aria-label="打开/收起侧边栏菜单「Building and running WasmEdge apps」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/book/zh-Hans/category/develop-wasm-apps-in-rust">Develop Wasm Apps in Rust</a><button aria-label="打开/收起侧边栏菜单「Develop Wasm Apps in Rust」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/setup">4.0 Set up Software for Building and Compiling Rust Programs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/hello_world">4.1 Hello world</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/os">4.2 Access OS services</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/zh-Hans/category/43-http-services">4.3 HTTP services</a><button aria-label="打开/收起侧边栏菜单「4.3 HTTP services」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/book/zh-Hans/category/44-socket-networking">4.4 Socket networking</a><button aria-label="打开/收起侧边栏菜单「4.4 Socket networking」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/socket_networking/client">4.4.1 Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/book/zh-Hans/develop/rust/socket_networking/server">4.4.1 Server</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/book/zh-Hans/category/45-ai-inference">4.5 AI Inference</a><button aria-label="打开/收起侧边栏菜单「4.5 AI Inference」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/my_sql_driver">4.6 MySQL-based Database Driver</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/book/zh-Hans/develop/rust/dapr">4.7 Use WasmEdge&#x27;s Dapr SDK to Connect Dapr Sidecar</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/developing-wasm-apps-in-javascript">Developing Wasm Apps in JavaScript</a><button aria-label="打开/收起侧边栏菜单「Developing Wasm Apps in JavaScript」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/develop-wasm-apps-in-cc">Develop Wasm Apps in C/C++</a><button aria-label="打开/收起侧边栏菜单「Develop Wasm Apps in C/C++」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/develop-wasm-apps-in-go">Develop Wasm Apps in Go</a><button aria-label="打开/收起侧边栏菜单「Develop Wasm Apps in Go」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/book/zh-Hans/category/deploy-wasmedge-apps-in-kubernetes">Deploy WasmEdge apps in Kubernetes</a><button aria-label="打开/收起侧边栏菜单「Deploy WasmEdge apps in Kubernetes」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/book/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/book/zh-Hans/category/develop-wasm-apps-in-rust"><span itemprop="name">Develop Wasm Apps in Rust</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/book/zh-Hans/category/44-socket-networking"><span itemprop="name">4.4 Socket networking</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">4.4.1 Server</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>4.4.1 Server</h1><p>As we described in the <a href="/book/zh-Hans/develop/rust/socket_networking/client">client</a> chapter, with the WasmEdge socket API, it is also possible for Rust developers to work directly on the socket level. In order for WasmEdge to become a cloud-native runtime for microservices, it needs to support HTTP servers. So, in this chapter, we will discuss<a href="#an-http-server">an HTTP server example</a> and <a href="#a-non-blocking-http-server-example">a non-blocking HTTP server example</a>.</p><blockquote><p>Before we started, make sure <a href="/book/zh-Hans/develop/rust/setup">you have Rust and WasmEdge installed</a>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="an-http-server-example">An HTTP server example<a class="hash-link" href="#an-http-server-example" title="标题的直接链接">​</a></h2><p>The <a href="https://github.com/second-state/wasmedge_wasi_socket/tree/main/examples/http_server" target="_blank" rel="noopener noreferrer">source code</a> for the HTTP server application is available as follows. The example below shows an HTTP server that echoes back any incoming request.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use bytecodec::DecodeExt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use httpcodec::{HttpVersion, ReasonPhrase, Request, RequestDecoder, Response, StatusCode};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::io::{Read, Write};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(feature = &quot;std&quot;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::net::{Shutdown, TcpListener, TcpStream};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(not(feature = &quot;std&quot;))]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use wasmedge_wasi_socket::{Shutdown, TcpListener, TcpStream};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn handle_http(req: Request&lt;String&gt;) -&gt; bytecodec::Result&lt;Response&lt;String&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ok(Response::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpVersion::V1_0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StatusCode::new(200)?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ReasonPhrase::new(&quot;&quot;)?,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    format!(&quot;echo: {}&quot;, req.body()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn handle_client(mut stream: TcpStream) -&gt; std::io::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let mut buff = [0u8; 1024];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let mut data = Vec::new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let n = stream.read(&amp;mut buff)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data.extend_from_slice(&amp;buff[0..n]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if n &lt; 1024 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let mut decoder =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestDecoder::&lt;httpcodec::BodyDecoder&lt;bytecodec::bytes::Utf8Decoder&gt;&gt;::default();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let req = match decoder.decode_from_bytes(data.as_slice()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(req) =&gt; handle_http(req),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(e) =&gt; Err(e),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let r = match req {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(r) =&gt; r,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let err = format!(&quot;{:?}&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Response::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpVersion::V1_0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StatusCode::new(500).unwrap(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReasonPhrase::new(err.as_str()).unwrap(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        err.clone(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let write_buf = r.to_string();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stream.write(write_buf.as_bytes())?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stream.shutdown(Shutdown::Both)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() -&gt; std::io::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let port = std::env::var(&quot;PORT&quot;).unwrap_or(1234.to_string());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  println!(&quot;new connection at {}&quot;, port);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let listener = TcpListener::bind(format!(&quot;0.0.0.0:{}&quot;, port))?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let _ = handle_client(listener.accept()?.0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can build and run <a href="https://github.com/second-state/wasmedge_wasi_socket/tree/main/examples/http_server" target="_blank" rel="noopener noreferrer">the example</a> in WasmEdge as follows.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get the source code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/second-state/wasmedge_wasi_socket.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd wasmedge_wasi_socket/http_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build the Rust code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo build --target wasm32-wasi --release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use the AoT compiler to get better performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wasmedgec target/wasm32-wasi/release/http_server.wasm target/wasm32-wasi/release/http_server.wasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run the example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$wasmedge target/wasm32-wasi/release/http.wasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new connection at 1234</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To test the HTTP server, you can submit a HTTP request to it via <code>curl</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&quot;name=WasmEdge&quot;</span><span class="token plain"> -X POST http://127.0.0.1:1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo: </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">WasmEdge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-non-blocking-http-server-example">A non-blocking HTTP server example<a class="hash-link" href="#a-non-blocking-http-server-example" title="标题的直接链接">​</a></h2><p>The <a href="https://github.com/second-state/wasmedge_wasi_socket/blob/main/examples/poll_tcp_listener.rs" target="_blank" rel="noopener noreferrer">source code</a> for a non-blocking HTTP server application is available. The following <code>main()</code> function starts an HTTP server. It receives events from multiple open connections, and processes those events as they are received by calling the async handler functions registered to each connection. This server can process events from multiple open connections concurrently.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() -&gt; std::io::Result&lt;()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut connects = Connects::new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let server = TcpListener::bind(&quot;127.0.0.1:1234&quot;, true)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    connects.add(NetConn::Server(server));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let subs = connects_to_subscriptions(&amp;connects);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let events = poll::poll(&amp;subs)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for event in events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            let conn_id = event.userdata as usize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            match connects.get_mut(conn_id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Some(NetConn::Server(server)) =&gt; match event.event_type {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    poll::EventType::Timeout =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    poll::EventType::Error(e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        return Err(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    poll::EventType::Read =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        let (mut tcp_client, addr) = server.accept(true)?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        println!(&quot;accept from {}&quot;, addr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        match tcp_client.write(DATA) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Ok(n) if n &lt; DATA.len() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                println!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    &quot;write hello error: {}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    io::Error::from(io::ErrorKind::WriteZero)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Ok(_) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Err(ref err) if would_block(err) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Err(ref err) if interrupted(err) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Err(err) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                println!(&quot;write hello error: {}&quot;, err);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        let id = connects.add(NetConn::Client(tcp_client));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        println!(&quot;add conn[{}]&quot;, id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    poll::EventType::Write =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Some(NetConn::Client(client)) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    match event.event_type {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        poll::EventType::Timeout =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // if Subscription timeout is not None.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            unreachable!()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        poll::EventType::Error(e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            println!(&quot;tcp_client[{}] recv a io error: {}&quot;, conn_id, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            connects.remove(conn_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        poll::EventType::Read =&gt; match handle_connection_read(client) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Ok(true) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                println!(&quot;tcp_client[{}] is closed&quot;, conn_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                connects.remove(conn_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Err(e) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                println!(&quot;tcp_client[{}] recv a io error: {}&quot;, conn_id, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                connects.remove(conn_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            _ =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        poll::EventType::Write =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _ =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>handle_connection()</code> function processes the data from those open connections. In this case, it just writes the request body into the response. It is also done asynchronously -- meaning that the <code>handle_connection()</code> function creates an event for the response, and puts it in the queue. The main application loop processes the event and sends the response when it is waiting for data from other connections.</p><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn handle_connection_read(connection: &amp;mut TcpStream) -&gt; io::Result&lt;bool&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut connection_closed = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut received_buff = [0u8; 2048];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut received_data = Vec::with_capacity(2048);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match connection.read(&amp;mut received_buff) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(0) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                connection_closed = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(n) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                received_data.extend_from_slice(&amp;received_buff[0..n]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(ref err) if would_block(err) =&gt; break,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(ref err) if interrupted(err) =&gt; continue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(err) =&gt; return Err(err),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if !received_data.is_empty() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if let Ok(str_buf) = std::str::from_utf8(&amp;received_data) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(&quot;Received data: {}&quot;, str_buf.trim_end());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(&quot;Received (none UTF-8) data: {:?}&quot;, received_data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if connection_closed {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Ok(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can build and run <a href="https://github.com/WasmEdge/wasmedge_hyper_demo/blob/main/server/" target="_blank" rel="noopener noreferrer">the example</a> in WasmEdge as follows.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get the source code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/second-state/wasmedge_wasi_socket.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd wasmedge_wasi_socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build the Rust code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo build --target wasm32-wasi --release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use the AoT compiler to get better performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wasmedgec target/wasm32-wasi/release/poll_tcp_listener.wasm target/wasm32-wasi/release/poll_tcp_listener.wasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run the example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wasmedge target/wasm32-wasi/release/poll_tcp_listener.wasm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To test the HTTP server, you can submit a HTTP request to it via <code>curl</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&quot;name=WasmEdge&quot;</span><span class="token plain"> -X POST http://127.0.0.1:1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo: </span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">WasmEdge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/alabulei1/book/docs/develop/rust/socket_networking/server.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/book/zh-Hans/develop/rust/socket_networking/client"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">4.4.1 Client</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/book/zh-Hans/category/45-ai-inference"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">4.5 AI Inference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#an-http-server-example" class="table-of-contents__link toc-highlight">An HTTP server example</a></li><li><a href="#a-non-blocking-http-server-example" class="table-of-contents__link toc-highlight">A non-blocking HTTP server example</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/book/zh-Hans/develop/overview">Develop</a></li><li class="footer__item"><a class="footer__link-item" href="/book/zh-Hans/embed/overview">Embed</a></li><li class="footer__item"><a class="footer__link-item" href="/book/zh-Hans/contribute/overview">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/U4B5sFTkFc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/realwasmedge" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 WasmEdge. Built with Docusaurus.</div></div></div></footer></div>
<script src="/book/zh-Hans/assets/js/runtime~main.bbb049d8.js"></script>
<script src="/book/zh-Hans/assets/js/main.29a7dd9a.js"></script>
</body>
</html>